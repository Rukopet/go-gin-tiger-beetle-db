# go-gin-tiger-beetle-db
learning project for TigerBeetle 

# Проект: Система управления финансами с TigerBeetle и Go

## Описание проекта

Вы создадите RESTful API сервер на Go, который использует TigerBeetle для управления финансовыми операциями. Это будет упрощенная система банковских операций с возможностью создания счетов, переводов денег и просмотра истории транзакций.

## Цели обучения

После завершения проекта вы будете понимать:
- Архитектуру и принципы работы TigerBeetle
- Как интегрировать TigerBeetle с Go приложением
- Основы создания финансовых систем
- Паттерны проектирования для работы с базами данных
- Создание чистой архитектуры в Go

## Техническое задание

### Функциональные требования

#### 1. Управление счетами
- **POST /accounts** - создание нового счета
  - Параметры: `currency` (USD, EUR, RUB), `initial_balance` (опционально)
  - Ответ: ID созданного счета и его данные
- **GET /accounts/{id}** - получение информации о счете
  - Ответ: ID, валюта, текущий баланс, дата создания
- **GET /accounts** - список всех счетов с пагинацией
  - Параметры: `page`, `limit`, `currency` (фильтр)

#### 2. Переводы денег
- **POST /transfers** - создание перевода
  - Параметры: `from_account_id`, `to_account_id`, `amount`, `description`
  - Валидация: проверка достаточности средств, существования счетов
  - Ответ: ID транзакции и её статус
- **GET /transfers/{id}** - получение информации о переводе
- **GET /transfers** - история переводов с фильтрацией
  - Параметры: `account_id`, `date_from`, `date_to`, `page`, `limit`

#### 3. Операции со счетами
- **POST /accounts/{id}/deposit** - пополнение счета
  - Параметры: `amount`, `description`
- **POST /accounts/{id}/withdraw** - списание со счета
  - Параметры: `amount`, `description`
- **GET /accounts/{id}/balance** - получение текущего баланса

#### 4. Отчетность
- **GET /accounts/{id}/statement** - выписка по счету
  - Параметры: `date_from`, `date_to`, `format` (JSON/CSV)
- **GET /stats/summary** - общая статистика
  - Количество счетов, общий оборот, количество транзакций

### Технические требования

#### Архитектура
Используйте clean architecture с следующими слоями:
- **Handler** - HTTP обработчики
- **Service** - бизнес-логика
- **Repository** - работа с TigerBeetle
- **Models** - структуры данных

#### Обработка ошибок
- Централизованная обработка ошибок
- Логирование всех операций
- Валидация входных данных
- Graceful shutdown

#### Безопасность
- Rate limiting
- Валидация всех входных параметров
- Защита от SQL-инъекций (хотя TigerBeetle не SQL)
- CORS настройки

## Поэтапная реализация

### Этап 1: Настройка окружения (1-2 дня)
1. Установите TigerBeetle локально
2. Создайте Go модуль с необходимыми зависимостями
3. Настройте структуру проекта
4. Создайте базовый HTTP сервер с роутингом

**Зависимости для Go:**
```go
// go.mod
module finance-api

go 1.21

require (
    github.com/gin-gonic/gin v1.9.1
    github.com/tigerbeetle/tigerbeetle-go v0.13.0
    github.com/google/uuid v1.3.0
    github.com/sirupsen/logrus v1.9.3
    github.com/stretchr/testify v1.8.4
)
```

### Этап 2: Интеграция с TigerBeetle (2-3 дня)
1. Создайте connection pool для TigerBeetle
2. Изучите структуру Account и Transfer в TigerBeetle
3. Создайте базовые операции: создание счета, создание перевода
4. Напишите тесты для базовых операций

**Ключевые концепции TigerBeetle:**
- Accounts имеют уникальные ID и ledger (тип счета)
- Transfers всегда между двумя счетами
- Все операции атомарны
- Balances вычисляются автоматически

### Этап 3: Бизнес-логика (3-4 дня)
1. Реализуйте сервисный слой с валидацией
2. Добавьте поддержку разных валют
3. Создайте логику для депозитов/снятий
4. Реализуйте проверку достаточности средств

### Этап 4: HTTP API (2-3 дня)
1. Создайте все endpoint'ы согласно спецификации
2. Добавьте middleware для логирования и обработки ошибок
3. Реализуйте пагинацию и фильтрацию
4. Добавьте валидацию входных данных

### Этап 5: Дополнительные возможности (2-3 дня)
1. Генерация отчетов в разных форматах
2. Rate limiting
3. Метрики и мониторинг
4. Документация API (Swagger/OpenAPI)

## Структура проекта

```
finance-api/
├── cmd/
│   └── server/
│       └── main.go
├── internal/
│   ├── config/
│   │   └── config.go
│   ├── handlers/
│   │   ├── account.go
│   │   ├── transfer.go
│   │   └── middleware.go
│   ├── services/
│   │   ├── account.go
│   │   └── transfer.go
│   ├── repository/
│   │   └── tigerbeetle.go
│   ├── models/
│   │   ├── account.go
│   │   ├── transfer.go
│   │   └── errors.go
│   └── utils/
│       └── validation.go
├── tests/
│   ├── integration/
│   └── unit/
├── docs/
│   └── api.yaml
├── docker-compose.yml
├── Dockerfile
├── go.mod
└── README.md
```

## Критерии оценки

### Базовый уровень
- Все основные endpoint'ы работают
- Корректная интеграция с TigerBeetle
- Базовая валидация данных
- Простые тесты

### Продвинутый уровень
- Чистая архитектура
- Comprehensive тестирование
- Обработка edge cases
- Логирование и мониторинг
- Документация

### Экспертный уровень
- Высокая производительность
- Graceful shutdown
- Метрики и трейсинг
- CI/CD pipeline
- Deployment готовность

## Полезные ресурсы

1. **TigerBeetle Documentation:** https://docs.tigerbeetle.com/
2. **TigerBeetle Go Client:** https://github.com/tigerbeetle/tigerbeetle-go
3. **Go Clean Architecture:** https://github.com/bxcodec/go-clean-arch
4. **Gin Framework:** https://gin-gonic.com/docs/

## Дополнительные задачи (по желанию)

1. **Веб-интерфейс**: Создайте простой фронтенд для визуализации счетов и переводов
2. **Webhook система**: Уведомления о важных событиях
3. **Audit log**: Детальное логирование всех операций
4. **Multi-tenancy**: Поддержка нескольких организаций
5. **Scheduled transfers**: Автоматические переводы по расписанию

## Советы по реализации

1. **Начните с малого**: Сначала реализуйте базовый функционал, затем добавляйте сложность
2. **Тестируйте по ходу**: Пишите тесты для каждого компонента
3. **Изучайте примеры**: TigerBeetle предоставляет отличные примеры кода
4. **Документируйте**: Ведите заметки о том, что изучаете
5. **Не бойтесь экспериментировать**: Попробуйте разные подходы к решению задач

Удачи в изучении! Этот проект даст вам глубокое понимание современных финансовых систем и высокопроизводительных баз данных.
